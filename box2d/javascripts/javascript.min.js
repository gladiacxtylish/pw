$(function(){new (Backbone.View.extend({pixelMeterRatio:30,boundaryThickness:10,b2World:null,b2Elements:[],mouseX:0,mouseY:0,isMouseDown:!1,b2Joint:null,colorsSets:[["#69D2E7","#A7DBD8","#E0E4CC","#F38630","#FA6900"],["#ECD078","#D95B43","#C02942","#542437","#53777A"],["#FE4365","#FC9D9A","#F9CDAD","#C8C8A9","#83AF9B"],["#E8DDCB","#CDB380","#036564","#033649","#031634"],["#556270","#4ECDC4","#C7F464","#FF6B6B","#C44D58"],["#CFF09E","#A8DBA8","#79BD9A","#3B8686","#0B486B"],["#774F38","#E08E79","#F1D4AF",
"#ECE5CE","#C5E0DC"],["#594F4F","#547980","#45ADA8","#9DE0AD","#E5FCC2"],["#D9CEB2","#948C75","#D5DED9","#7A6A53","#99B2B7"],["#490A3D","#BD1550","#E97F02","#F8CA00","#8A9B0F"],["#EFFFCD","#DCE9BE","#555152","#2E2633","#99173C"],["#00A0B0","#6A4A3C","#CC333F","#EB6841","#EDC951"],["#D1F2A5","#EFFAB4","#FFC48C","#FF9F80","#F56991"],["#67917A","#170409","#B8AF03","#CCBF82","#E33258"],["#8C2318","#5E8C6A","#88A65E","#BFB35A","#F2C45A"],["#FFFFFF","#CBE86B","#F2E9E1","#1C140D","#CBE86B"],["#413E4A","#73626E",
"#B38184","#F0B49E","#F7E4BE"],["#EEE6AB","#C5BC8E","#696758","#45484B","#36393B"],["#D3E2B6","#C3DBB4","#AACCB1","#87BDB1","#68B3AF"],["#351330","#424254","#64908A","#E8CAA4","#CC2A41"],["#FAD089","#FF9C5B","#F5634A","#ED303C","#3B8183"]],initialize:function(){_.bindAll(this,"mouseDownEventListener","mouseUpEventListener","updateMouseCoordinates","updateWorldEventListener");this.b2World=new Box2D.Dynamics.b2World(new Box2D.Common.Math.b2Vec2(0,9.8),!0);this.createBoundaries();this.addBallsToWorld();
$("#b2dDiv").mousedown(this.mouseDownEventListener);$(document).mouseup(this.mouseUpEventListener);setInterval(this.updateWorldEventListener,1E3/60)},updateWorldEventListener:function(){this.controlMouse();this.b2World.Step(1/60,10,10);this.b2World.ClearForces();for(var a=0;a<this.b2Elements.length;a++){var c=this.b2Elements[a].GetUserData();this.b2Elements[a].GetPosition();this.b2Elements[a].GetPosition();c.css("left",this.b2Elements[a].GetPosition().x*this.pixelMeterRatio);c.css("top",this.b2Elements[a].GetPosition().y*
this.pixelMeterRatio);var b=Math.round(100*(180*this.b2Elements[a].GetAngle()/Math.PI))/100;c.css("-webkit-transform","rotate("+b+"deg)");c.css("-moz-transform","rotate("+b+"deg)");c.css("msTransform","rotate("+b+"deg)")}},mouseDownEventListener:function(a){this.isMouseDown=!0;this.updateMouseCoordinates(a);document.addEventListener("mousemove",this.updateMouseCoordinates,!0)},mouseUpEventListener:function(){document.removeEventListener("mousemove",this.updateMouseCoordinates,!0);this.isMouseDown=
!1},updateMouseCoordinates:function(a){this.mouseX=(a.pageX-$("#b2dDiv").offset().left)/this.pixelMeterRatio;this.mouseY=(a.pageY-$("#b2dDiv").offset().top)/this.pixelMeterRatio},addInstructionsToWorld:function(){var a=$("<div></div>").attr({width:200,height:200});a.css("position","absolute");a.css("border","1px coral solid");a.css("-webkit-transform-origin","0% 0%");a.css("-moz-transform-origin","0% 0%");a.css("msTransformOrigin","0% 0%");$("#b2dDiv").append(a);var c=$("<canvas></canvas>").attr({width:200,
height:200}),b=c[0].getContext("2d");b.fillStyle="rgb(200,0,0)";b.beginPath();b.arc(100,100,100,0,2*Math.PI,!0);b.closePath();b.fill();a.append(c);c=new Box2D.Dynamics.b2BodyDef;c.position.Set(10/this.pixelMeterRatio,10/this.pixelMeterRatio);c.type=Box2D.Dynamics.b2Body.b2_dynamicBody;c.userData=a;a=this.b2World.CreateBody(c);c=new Box2D.Collision.Shapes.b2CircleShape;c.SetRadius(100/this.pixelMeterRatio);c.SetLocalPosition(new Box2D.Common.Math.b2Vec2(100/this.pixelMeterRatio,100/this.pixelMeterRatio));
b=new Box2D.Dynamics.b2FixtureDef;b.shape=c;b.density=0.7;b.friction=0.5;b.restitution=0.5;a.CreateFixture(b);this.b2Elements.push(a)},addEducationsToWorld:function(){var a=this.addElementToWorld(600,150,100,"#948C75","Education","","#D5DED9"),c=this.addElementToWorld(650,50,50,"#948C75","UCSD","2008-2011","#D5DED9"),b=this.addElementToWorld(650,350,50,"#948C75","De Anza","2006-2008","#D5DED9"),d=new Box2D.Dynamics.Joints.b2DistanceJointDef;d.Initialize(a,c,new Box2D.Common.Math.b2Vec2(700/this.pixelMeterRatio,
250/this.pixelMeterRatio),new Box2D.Common.Math.b2Vec2(700/this.pixelMeterRatio,100/this.pixelMeterRatio));this.b2World.CreateJoint(d);d=new Box2D.Dynamics.Joints.b2DistanceJointDef;d.Initialize(a,b,new Box2D.Common.Math.b2Vec2(700/this.pixelMeterRatio,250/this.pixelMeterRatio),new Box2D.Common.Math.b2Vec2(700/this.pixelMeterRatio,400/this.pixelMeterRatio));this.b2World.CreateJoint(d)},addBallsToWorld:function(){for(var a=0;30>a;a++)x=Math.floor(Math.random()*($("#b2dDiv").width()-100)),y=Math.floor(Math.random()*
($("#b2dDiv").height()/20)),colorsSet=this.colorsSets[Math.floor(Math.random()*this.colorsSets.length)],this.addBallToWorld(x,y,Math.floor(5*Math.random())+1,colorsSet)},addBallToWorld:function(a,c,b,d){var e=10*b,f=$("<div></div>").attr({width:2*e,height:2*e});f.css("position","absolute");f.css("left",a);f.css("top",c);f.css("-webkit-transform-origin","0% 0%");f.css("-moz-transform-origin","0% 0%");f.css("msTransformOrigin","0% 0%");$("#b2dDiv").append(f);for(var i=$("<canvas></canvas>").attr({width:2*
e,height:2*e}),g=i[0].getContext("2d"),h=0;h<b;h++)g.fillStyle=d[Math.floor(5*Math.random())],g.beginPath(),g.arc(e,e,e-10*h,0,2*Math.PI,!0),g.closePath(),g.fill();f.append(i);b=new Box2D.Dynamics.b2BodyDef;b.position.Set(a/this.pixelMeterRatio,c/this.pixelMeterRatio);b.type=Box2D.Dynamics.b2Body.b2_dynamicBody;b.userData=f;a=this.b2World.CreateBody(b);c=new Box2D.Collision.Shapes.b2CircleShape;c.SetRadius(e/this.pixelMeterRatio);c.SetLocalPosition(new Box2D.Common.Math.b2Vec2(e/this.pixelMeterRatio,
e/this.pixelMeterRatio));e=new Box2D.Dynamics.b2FixtureDef;e.shape=c;e.density=1;e.friction=0.5;e.restitution=0.2;a.CreateFixture(e);a.SetLinearVelocity(new Box2D.Common.Math.b2Vec2(40*Math.random()-20,20*Math.random()));this.b2Elements.push(a)},setDebugDraw:function(){var a=new Box2D.Dynamics.b2DebugDraw;a.SetSprite(document.getElementById("canvas").getContext("2d"));a.SetDrawScale(30);a.SetFillAlpha(0.5);a.SetLineThickness(1);a.SetFlags(Box2D.Dynamics.b2DebugDraw.e_shapeBit|Box2D.Dynamics.b2DebugDraw.e_jointBit);
this.b2World.SetDebugDraw(a)},controlMouse:function(){if(!0==this.isMouseDown&&null==this.b2Joint){var a=this.getElementFromWorld();if(null!=a){var c=new Box2D.Dynamics.Joints.b2MouseJointDef;c.bodyA=this.b2World.GetGroundBody();c.bodyB=a;c.target.Set(this.mouseX,this.mouseY);c.maxForce=3E3*a.GetMass();this.b2Joint=this.b2World.CreateJoint(c)}}null!=this.b2Joint&&(!0==this.isMouseDown?this.b2Joint.SetTarget(new Box2D.Common.Math.b2Vec2(this.mouseX,this.mouseY)):(this.b2World.DestroyJoint(this.b2Joint),
this.b2Joint=null))},getElementFromWorld:function(){var a=new Box2D.Common.Math.b2Vec2(this.mouseX,this.mouseY),c=null;this.b2World.QueryPoint(function(a){return a.GetBody().GetType()==Box2D.Dynamics.b2Body.b2_dynamicBody?(c=a.GetBody(),!1):!0},a);return c},getElementCoordinates:function(a){for(var c=0,b=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)c+=a.offsetLeft-a.scrollLeft,b+=a.offsetTop-a.scrollTop,a=a.offsetParent;return{x:c,y:b}},createBoundaries:function(){var a,c,b,d=$("#b2dDiv");a=new Box2D.Dynamics.b2BodyDef;
a.position.Set(d.width()/2/this.pixelMeterRatio,0/this.pixelMeterRatio);a.type=Box2D.Dynamics.b2Body.b2_staticBody;a=this.b2World.CreateBody(a);c=new Box2D.Collision.Shapes.b2PolygonShape;c.SetAsBox(d.width()/2/this.pixelMeterRatio,this.boundaryThickness/2/this.pixelMeterRatio);b=new Box2D.Dynamics.b2FixtureDef;b.shape=c;b.friction=0.5;b.restitution=0.5;a.CreateFixture(b);a=new Box2D.Dynamics.b2BodyDef;a.position.Set(d.width()/2/this.pixelMeterRatio,d.height()/this.pixelMeterRatio);a.type=Box2D.Dynamics.b2Body.b2_staticBody;
a=this.b2World.CreateBody(a);c=new Box2D.Collision.Shapes.b2PolygonShape;c.SetAsBox(d.width()/2/this.pixelMeterRatio,this.boundaryThickness/2/this.pixelMeterRatio);b=new Box2D.Dynamics.b2FixtureDef;b.shape=c;b.friction=0.5;b.restitution=0.5;a.CreateFixture(b);a=new Box2D.Dynamics.b2BodyDef;a.position.Set(0/this.pixelMeterRatio,d.height()/2/this.pixelMeterRatio);a.type=Box2D.Dynamics.b2Body.b2_staticBody;a=this.b2World.CreateBody(a);c=new Box2D.Collision.Shapes.b2PolygonShape;c.SetAsBox(this.boundaryThickness/
2/this.pixelMeterRatio,d.height()/2/this.pixelMeterRatio);b=new Box2D.Dynamics.b2FixtureDef;b.shape=c;b.friction=0.5;b.restitution=0.5;a.CreateFixture(b);a=new Box2D.Dynamics.b2BodyDef;a.position.Set(d.width()/this.pixelMeterRatio,d.height()/2/this.pixelMeterRatio);a.type=Box2D.Dynamics.b2Body.b2_staticBody;a=this.b2World.CreateBody(a);c=new Box2D.Collision.Shapes.b2PolygonShape;c.SetAsBox(this.boundaryThickness/2/this.pixelMeterRatio,d.height()/2/this.pixelMeterRatio);b=new Box2D.Dynamics.b2FixtureDef;
b.shape=c;b.friction=0.5;b.restitution=0.5;a.CreateFixture(b)},pad:function(a,c){for(a+="";a.length<c;)a="0"+a;return a},changeColor:function(a,c,b){var a=a.replace(/^\s*|\s*$/,""),a=a.replace(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i,"#$1$1$2$2$3$3"),c=Math.round(256*c)*(b?-1:1),d=a.match(RegExp("^rgba?\\(\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])\\s*,\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])\\s*,\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])(?:\\s*,\\s*(0|1|0?\\.\\d+))?\\s*\\)$","i")),e=d&&
null!=d[4]?d[4]:null,a=d?[d[1],d[2],d[3]]:a.replace(/^#?([a-f0-9][a-f0-9])([a-f0-9][a-f0-9])([a-f0-9][a-f0-9])/i,function(a,b,c,d){return parseInt(b,16)+","+parseInt(c,16)+","+parseInt(d,16)}).split(/,/);return d?"rgb"+(null!==e?"a":"")+"("+Math[b?"max":"min"](parseInt(a[0],10)+c,b?0:255)+", "+Math[b?"max":"min"](parseInt(a[1],10)+c,b?0:255)+", "+Math[b?"max":"min"](parseInt(a[2],10)+c,b?0:255)+(null!==e?", "+e:"")+")":["#",this.pad(Math[b?"max":"min"](parseInt(a[0],10)+c,b?0:255).toString(16),2),
this.pad(Math[b?"max":"min"](parseInt(a[1],10)+c,b?0:255).toString(16),2),this.pad(Math[b?"max":"min"](parseInt(a[2],10)+c,b?0:255).toString(16),2)].join("")}}))});$(document).ready(function(){});